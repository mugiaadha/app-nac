<div class="container-fluid my-courses-page">
  <!-- Page Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h1 class="h3 mb-1">{{ pageConfig.title }}</h1>
      <p class="text-muted mb-0">{{ pageConfig.subtitle }}</p>
    </div>
    <div class="text-end">
      <small class="text-muted"
        >Total Enrolled: {{ courses.length }} courses</small
      >
    </div>
  </div>

  <!-- Filter Tabs -->
  <div class="filter-tabs mb-4" *ngIf="pageConfig.showFilters">
    <div class="btn-group" role="group">
      <button
        type="button"
        class="btn btn-outline-primary"
        [class.active]="activeFilter === filter.key"
        (click)="filterCourses(filter.key)"
        *ngFor="let filter of filters"
      >
        <i [class]="filter.icon" class="me-1"></i>
        {{ filter.label }} ({{ getFilterCount(filter.key) }})
      </button>
    </div>
  </div>

  <!-- Courses Grid -->
  <div class="row g-4">
    <div class="col-12" *ngFor="let course of filteredCourses">
      <div class="content-card course-card">
        <div class="row g-0 align-items-center">
          <!-- Course Image -->
          <div class="col-md-3 col-lg-2">
            <div class="course-image">
              <img
                [src]="course.image"
                [alt]="course.title"
                class="img-fluid rounded"
              />
              <div class="status-overlay">
                <span
                  class="badge"
                  [ngClass]="getStatusBadgeClass(course.status)"
                >
                  {{ getStatusText(course.status) }}
                </span>
              </div>
            </div>
          </div>

          <!-- Course Content -->
          <div class="col-md-6 col-lg-7">
            <div class="course-content">
              <h5 class="course-title mb-2">{{ course.title }}</h5>
              <p class="course-description text-muted mb-2">
                {{ course.description }}
              </p>

              <div class="course-meta d-flex flex-wrap gap-3 mb-3">
                <small class="text-muted">
                  <i class="bi bi-person"></i> {{ course.instructor }}
                </small>
                <small class="text-muted">
                  <i class="bi bi-clock"></i> {{ course.duration }}
                </small>
                <small class="text-muted">
                  <i class="bi bi-tag"></i> {{ course.category }}
                </small>
                <small class="text-muted">
                  <i class="bi bi-calendar"></i> Enrolled:
                  {{ course.enrolledDate | date : "MMM dd, yyyy" }}
                </small>
              </div>

              <!-- Progress Section -->
              <div
                class="progress-section mb-3"
                *ngIf="course.status !== 'not-started'"
              >
                <div
                  class="d-flex justify-content-between align-items-center mb-2"
                >
                  <span class="small fw-medium">Progress</span>
                  <span class="small text-muted"
                    >{{ course.completedLessons }}/{{
                      course.totalLessons
                    }}
                    lessons</span
                  >
                </div>
                <div class="progress" style="height: 8px">
                  <div
                    class="progress-bar"
                    [style.width.%]="course.progress"
                    [class]="getProgressBarClass(course.status)"
                  ></div>
                </div>
                <small class="text-muted mt-1"
                  >{{ course.progress }}% complete</small
                >
              </div>

              <!-- Last Accessed -->
              <div
                *ngIf="course.lastAccessed && course.status === 'in-progress'"
              >
                <small class="text-muted">
                  <i class="bi bi-clock-history"></i> Last accessed:
                  {{ course.lastAccessed | date : "MMM dd, yyyy" }}
                </small>
              </div>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="col-md-3 col-lg-3">
            <div class="course-actions text-end">
              <!-- Dynamic Action Buttons based on Status -->
              <ng-container [ngSwitch]="course.status">
                <!-- Not Started Actions -->
                <div *ngSwitchCase="'not-started'">
                  <button
                    class="btn btn-primary btn-sm mb-2 w-100"
                    (click)="executeAction('startCourse', course)"
                  >
                    <i class="bi bi-play-circle me-1"></i>
                    Start Course
                  </button>
                </div>

                <!-- In Progress Actions -->
                <div *ngSwitchCase="'in-progress'">
                  <button
                    class="btn bg-malibu-beach btn-sm mb-2 w-100"
                    (click)="executeAction('continueCourse', course)"
                  >
                    <i class="bi bi-play-circle me-1"></i>
                    Continue Learning
                  </button>
                </div>

                <!-- Completed Actions -->
                <div *ngSwitchCase="'completed'">
                  <button
                    class="btn btn-success btn-sm mb-2 w-100"
                    (click)="executeAction('continueCourse', course)"
                  >
                    <i class="bi bi-arrow-clockwise me-1"></i>
                    Review Course
                  </button>
                  <div class="d-flex gap-1 mb-2">
                    <button
                      class="btn btn-outline-primary btn-sm flex-fill"
                      (click)="executeAction('downloadCertificate', course)"
                      title="Download Certificate"
                    >
                      <i class="bi bi-download"></i>
                    </button>
                    <button
                      class="btn btn-outline-primary btn-sm flex-fill"
                      (click)="executeAction('viewCertificate', course)"
                      title="View Certificate"
                    >
                      <i class="bi bi-award"></i>
                    </button>
                  </div>
                </div>
              </ng-container>

              <!-- Common Dropdown Actions -->
              <div class="mt-2">
                <div class="dropdown">
                  <button
                    class="btn btn-outline-secondary btn-sm dropdown-toggle w-100"
                    type="button"
                    data-bs-toggle="dropdown"
                  >
                    <i class="bi bi-three-dots"></i>
                  </button>
                  <ul class="dropdown-menu">
                    <li *ngFor="let action of dropdownActions">
                      <div *ngIf="action.key === 'divider'">
                        <hr class="dropdown-divider" />
                      </div>
                      <a
                        *ngIf="action.key !== 'divider'"
                        class="dropdown-item"
                        [class]="action.color"
                        href="#"
                        (click)="
                          executeAction(action.action, course);
                          $event.preventDefault()
                        "
                      >
                        <i [class]="action.icon" class="me-2"></i
                        >{{ action.label }}
                      </a>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <div class="text-center py-5" *ngIf="filteredCourses.length === 0">
    <div class="empty-state">
      <i
        [class]="
          activeFilter === 'all'
            ? emptyStateConfig.all.icon
            : emptyStateConfig.filtered.icon
        "
        class="text-muted"
        style="font-size: 4rem"
      ></i>
      <h4 class="mt-3 text-muted">
        {{
          activeFilter === "all"
            ? emptyStateConfig.all.title
            : emptyStateConfig.filtered.title
        }}
      </h4>
      <p class="text-muted mb-4">
        {{
          activeFilter === "all"
            ? emptyStateConfig.all.message
            : emptyStateConfig.filtered.message
        }}
      </p>

      <!-- Action button for 'all' filter -->
      <button
        *ngIf="activeFilter === 'all'"
        class="btn {{ emptyStateConfig.all.action.color }}"
        [routerLink]="emptyStateConfig.all.action.route"
      >
        <i [class]="emptyStateConfig.all.action.icon" class="me-2"></i>
        {{ emptyStateConfig.all.action.label }}
      </button>

      <!-- Action button for filtered results -->
      <button
        *ngIf="activeFilter !== 'all'"
        class="btn btn-{{ emptyStateConfig.filtered.action.color }}"
        (click)="clearFilter()"
      >
        <i [class]="emptyStateConfig.filtered.action.icon" class="me-2"></i>
        {{ emptyStateConfig.filtered.action.label }}
      </button>
    </div>
  </div>

  <!-- Learning Statistics -->
  <div class="row mt-5" *ngIf="courses.length > 0 && pageConfig.showStats">
    <div class="col-12">
      <div class="content-card">
        <h5 class="mb-4">Learning Statistics</h5>
        <div class="row g-4">
          <div class="col-md-3 col-6" *ngFor="let stat of learningStats">
            <div class="stat-item text-center">
              <div class="stat-icon mb-2" [class]="stat.color">
                <i [class]="stat.icon" style="font-size: 2rem"></i>
              </div>
              <div class="stat-number h4 mb-1">
                {{ getStatValue(stat.key) }}
              </div>
              <div class="stat-label text-muted small">{{ stat.label }}</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
