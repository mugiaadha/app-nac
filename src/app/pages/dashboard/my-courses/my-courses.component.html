<div class="my-courses-page">
  <!-- Page Header -->
  <div class="page-header mb-4">
    <div class="d-flex justify-content-between align-items-start">
      <div>
        <h1 class="h3 fw-bold mb-2">My Courses</h1>
        <p class="text-muted mb-0">Kelola dan lanjutkan pembelajaran Anda</p>
      </div>
      <div class="header-actions">
        <button class="btn btn-outline-secondary me-2">
          <i class="bi bi-download me-1"></i>
          Export
        </button>
        <button class="btn btn-primary">
          <i class="bi bi-plus-lg me-1"></i>
          Browse Courses
        </button>
      </div>
    </div>
  </div>

  <!-- Filters & Search -->
  <div class="filters-section mb-4">
    <div class="row g-3">
      <!-- Search -->
      <div class="col-md-4">
        <div class="search-box">
          <div class="input-group">
            <span class="input-group-text bg-white border-end-0">
              <i class="bi bi-search text-muted"></i>
            </span>
            <input
              type="text"
              class="form-control border-start-0"
              placeholder="Cari courses..."
              [(ngModel)]="searchTerm"
              (input)="onSearchChange($event)"
            />
          </div>
        </div>
      </div>

      <!-- Category Filter -->
      <div class="col-md-2">
        <select
          class="form-select"
          [value]="selectedCategory"
          (change)="onCategoryChange($event)"
        >
          <option value="all">Semua Kategori</option>
          <option value="akuntansi">Akuntansi</option>
          <option value="technology">Technology</option>
          <option value="marketing">Marketing</option>
          <option value="finance">Finance</option>
          <option value="management">Management</option>
          <option value="brevet">Brevet</option>
        </select>
      </div>

      <!-- Sort -->
      <div class="col-md-2">
        <select
          class="form-select"
          [value]="selectedSort"
          (change)="onSortChange($event)"
        >
          <option value="recent">Terbaru Diakses</option>
          <option value="progress">Progress</option>
          <option value="title">Nama Course</option>
          <option value="enrolled">Tanggal Daftar</option>
        </select>
      </div>

      <!-- Results Count -->
      <div class="col-md-4 d-flex align-items-center justify-content-end">
        <span class="text-muted small">
          Menampilkan {{ filteredCourses.length }} dari
          {{ courses.length }} courses
        </span>
      </div>
    </div>

    <!-- Status Filter Tabs -->
    <div class="status-filters mt-3">
      <ul class="nav nav-pills">
        <li class="nav-item">
          <button
            class="nav-link active"
            [class.active]="activeFilter === 'all'"
            (click)="filterCourses('all')"
          >
            Semua Status
            <span class="badge bg-light text-dark ms-2">{{
              courses.length
            }}</span>
          </button>
        </li>
        <li class="nav-item">
          <button
            class="nav-link"
            [class.active]="activeFilter === 'in-progress'"
            (click)="filterCourses('in-progress')"
          >
            Sedang Berjalan
            <span class="badge bg-light text-dark ms-2">{{
              getFilterCount("in-progress")
            }}</span>
          </button>
        </li>
        <li class="nav-item">
          <button
            class="nav-link"
            [class.active]="activeFilter === 'completed'"
            (click)="filterCourses('completed')"
          >
            Selesai
            <span class="badge bg-light text-dark ms-2">{{
              getFilterCount("completed")
            }}</span>
          </button>
        </li>
        <li class="nav-item">
          <button
            class="nav-link"
            [class.active]="activeFilter === 'not-started'"
            (click)="filterCourses('not-started')"
          >
            Belum Dimulai
            <span class="badge bg-light text-dark ms-2">{{
              getFilterCount("not-started")
            }}</span>
          </button>
        </li>
      </ul>
    </div>
  </div>

  <!-- Courses Grid -->
  <div class="row g-4">
    <div class="col-12" *ngFor="let course of filteredCourses">
      <div class="content-card course-card">
        <div class="row g-0 align-items-center">
          <!-- Course Image -->
          <div class="col-md-3 col-lg-2">
            <div class="course-image">
              <img
                [src]="course.image"
                [alt]="course.title"
                class="img-fluid rounded"
              />
              <div class="status-overlay">
                <span
                  class="badge"
                  [ngClass]="getStatusBadgeClass(course.status)"
                >
                  {{ getStatusText(course.status) }}
                </span>
              </div>
            </div>
          </div>

          <!-- Course Content -->
          <div class="col-md-6 col-lg-7">
            <div class="course-content">
              <h5 class="course-title mb-2">{{ course.title }}</h5>
              <p class="course-description text-muted mb-2">
                {{ course.description }}
              </p>

              <div class="course-meta d-flex flex-wrap gap-3 mb-3">
                <small class="text-muted">
                  <i class="bi bi-person"></i> {{ course.instructor }}
                </small>
                <small class="text-muted">
                  <i class="bi bi-clock"></i> {{ course.duration }}
                </small>
                <small class="text-muted">
                  <i class="bi bi-tag"></i> {{ course.category }}
                </small>
                <small class="text-muted">
                  <i class="bi bi-calendar"></i> Enrolled:
                  {{ course.enrolledDate | date : "MMM dd, yyyy" }}
                </small>
              </div>

              <!-- Progress Section -->
              <div
                class="progress-section mb-3"
                *ngIf="course.status !== 'not-started'"
              >
                <div
                  class="d-flex justify-content-between align-items-center mb-2"
                >
                  <span class="small fw-medium">Progress</span>
                  <span class="small text-muted"
                    >{{ course.completedLessons }}/{{
                      course.totalLessons
                    }}
                    lessons</span
                  >
                </div>
                <div class="progress" style="height: 8px">
                  <div
                    class="progress-bar"
                    [style.width.%]="course.progress"
                    [class]="getProgressBarClass(course.status)"
                  ></div>
                </div>
                <small class="text-muted mt-1"
                  >{{ course.progress }}% complete</small
                >
              </div>

              <!-- Last Accessed -->
              <div
                *ngIf="course.lastAccessed && course.status === 'in-progress'"
              >
                <small class="text-muted">
                  <i class="bi bi-clock-history"></i> Last accessed:
                  {{ course.lastAccessed | date : "MMM dd, yyyy" }}
                </small>
              </div>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="col-md-3 col-lg-3">
            <div class="course-actions text-end">
              <!-- Dynamic Action Buttons based on Status -->
              <ng-container [ngSwitch]="course.status">
                <!-- Not Started Actions -->
                <div *ngSwitchCase="'not-started'">
                  <button
                    class="btn btn-default btn-sm mb-2 w-100"
                    (click)="executeAction('startCourse', course)"
                  >
                    <i class="bi bi-play-circle me-1"></i>
                    Start Course
                  </button>
                </div>

                <!-- In Progress Actions -->
                <div *ngSwitchCase="'in-progress'">
                  <button
                    class="btn bg-malibu-purple btn-sm mb-2 w-100"
                    (click)="executeAction('continueCourse', course)"
                  >
                    <i class="bi bi-play-circle me-1"></i>
                    Continue Learning
                  </button>
                </div>

                <!-- Completed Actions -->
                <div *ngSwitchCase="'completed'">
                  <button
                    class="btn btn-success btn-sm mb-2 w-100"
                    (click)="executeAction('continueCourse', course)"
                  >
                    <i class="bi bi-arrow-clockwise me-1"></i>
                    Review Course
                  </button>
                  <div class="d-flex gap-1 mb-2">
                    <button
                      class="btn btn-outline-primary btn-sm flex-fill"
                      (click)="executeAction('downloadCertificate', course)"
                      title="Download Certificate"
                    >
                      <i class="bi bi-download"></i>
                    </button>
                    <button
                      class="btn btn-outline-primary btn-sm flex-fill"
                      (click)="executeAction('viewCertificate', course)"
                      title="View Certificate"
                    >
                      <i class="bi bi-award"></i>
                    </button>
                  </div>
                </div>
              </ng-container>

              <!-- Common Actions Menu -->
              <div class="mt-2">
                <div class="dropdown">
                  <button
                    class="btn btn-outline-secondary btn-sm dropdown-toggle w-100"
                    type="button"
                    data-bs-toggle="dropdown"
                  >
                    <i class="bi bi-three-dots"></i>
                  </button>
                  <ul class="dropdown-menu">
                    <li>
                      <a
                        class="dropdown-item text-primary"
                        [routerLink]="['/my-courses', course.id]"
                      >
                        <i class="bi bi-info-circle me-2"></i>Course Details
                      </a>
                    </li>
                    <li>
                      <a
                        class="dropdown-item text-secondary"
                        href="#"
                        (click)="
                          executeAction('toggleBookmark', course);
                          $event.preventDefault()
                        "
                      >
                        <i class="bi bi-bookmark me-2"></i>Bookmark
                      </a>
                    </li>
                    <li>
                      <a
                        class="dropdown-item text-secondary"
                        href="#"
                        (click)="
                          executeAction('shareCourse', course);
                          $event.preventDefault()
                        "
                      >
                        <i class="bi bi-share me-2"></i>Share
                      </a>
                    </li>
                    <li><hr class="dropdown-divider" /></li>
                    <li>
                      <a
                        class="dropdown-item text-danger"
                        href="#"
                        (click)="
                          executeAction('unenrollCourse', course);
                          $event.preventDefault()
                        "
                      >
                        <i class="bi bi-x-circle me-2"></i>Unenroll
                      </a>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <div class="text-center py-5" *ngIf="filteredCourses.length === 0">
    <div class="empty-state">
      <i
        class="bi bi-book text-muted"
        style="font-size: 4rem"
        *ngIf="activeFilter === 'all'"
      ></i>
      <i
        class="bi bi-funnel text-muted"
        style="font-size: 4rem"
        *ngIf="activeFilter !== 'all'"
      ></i>

      <h4 class="mt-3 text-muted" *ngIf="activeFilter === 'all'">
        No courses found
      </h4>
      <h4 class="mt-3 text-muted" *ngIf="activeFilter !== 'all'">
        No courses found
      </h4>

      <p class="text-muted mb-4" *ngIf="activeFilter === 'all'">
        You haven't enrolled in any courses yet.
      </p>
      <p class="text-muted mb-4" *ngIf="activeFilter !== 'all'">
        No courses match the selected filter.
      </p>

      <!-- Action button for 'all' filter -->
      <button
        *ngIf="activeFilter === 'all'"
        class="btn btn-gradient"
        routerLink="/courses"
      >
        <i class="bi bi-plus-circle me-2"></i>
        Browse Courses
      </button>

      <!-- Action button for filtered results -->
      <button
        *ngIf="activeFilter !== 'all'"
        class="btn btn-outline-primary"
        (click)="clearFilter()"
      >
        <i class="bi bi-arrow-left me-2"></i>
        View All Courses
      </button>
    </div>
  </div>

  <!-- Learning Statistics -->
  <div class="row mt-5" *ngIf="courses.length > 0 && pageConfig.showStats">
    <div class="col-12">
      <div class="content-card">
        <h5 class="mb-4">Learning Statistics</h5>
        <div class="row g-4">
          <div class="col-md-3 col-6" *ngFor="let stat of learningStats">
            <div class="stat-item text-center">
              <div class="stat-icon mb-2" [class]="stat.color">
                <i [class]="stat.icon" style="font-size: 2rem"></i>
              </div>
              <div class="stat-number h4 mb-1">
                {{ getStatValue(stat.key) }}
              </div>
              <div class="stat-label text-muted small">{{ stat.label }}</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
